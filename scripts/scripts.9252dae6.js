"use strict";angular.module("salary360initiumdatacomApp",["ngAnimate","ngAria","ngCookies","ngMessages","ngResource","ngRoute","ngSanitize","ngTouch"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/about",{templateUrl:"views/about.html",controller:"AboutCtrl"}).otherwise({redirectTo:"/"})}]),angular.module("salary360initiumdatacomApp").controller("MainCtrl",["$scope","$http",function(a,b){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"],a.input={area:"a01",gender:"both",salary:11555},a.options={area:["a01","b02","c03"],gender:["male","female","both"]},b.get("http://salary360.initiumdata.com/api/census2011/geo/translation-areas.json").success(function(b){a.options.area=_.map(b,function(a,b){return b})})}]),angular.module("salary360initiumdatacomApp").controller("AboutCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("salary360initiumdatacomApp",[]).factory("d3Service",["$document","$q","$rootScope",function(a,b,c){function d(){c.$apply(function(){e.resolve(window.d3)})}var e=b.defer(),f=a[0].createElement("script");f.type="text/javascript",f.async=!0,f.src="bower_components/d3/d3.js",f.onreadystatechange=function(){"complete"===this.readyState&&d()},f.onload=d;var g=a[0].getElementsByTagName("body")[0];return g.appendChild(f),{d3:function(){return e.promise}}}]),angular.module("salary360initiumdatacomApp").directive("salaryRankingChart",[function(){return{restrict:"EA",scope:{area:"@",gender:"@",salary:"@"},link:function(a){var b=[[-1,"< 2000","a78_<","78"],[2e3,"2000 - 3999","a80_2000","80"],[4e3,"4000 - 5999","a82_4000","82"],[6e3,"6000 - 7999","a84_6000","84"],[8e3,"8000 - 9999","a86_8000","86"],[1e4,"10000 - 14999","a88_10000","88"],[15e3,"15000 - 19999","a90_15000","90"],[2e4,"20000 - 24999","a92_20000","92"],[25e3,"25000 - 29999","a94_25000","94"],[3e4,"30000 - 39999","a96_30000","96"],[4e4,"40000 - 59999","a98_40000","98"],[6e4,">= 60000","a100_>=","100"]],c=function(a,b,c){for(var d=0,e=0,f=0,g=a[0].row,h=1;h<c.length;h++){var i=parseInt(a[h-1].value);e+=i,c[h][0]<=b&&(d+=i,f=h,g=a[h].row)}return{binID:f,binName:g,cummulative:d,total:e,ratio:d/e}},d=function(d){var e={top:20,right:20,bottom:30,left:40},f=document.querySelector(".chart").offsetWidth,g=document.querySelector(".chart").offsetHeight,h=f-e.left-e.right,i=g-e.top-e.bottom,j=d.scale.ordinal().rangeRoundBands([0,h],.1),k=d.scale.linear().range([i,0]),l=d.svg.axis().scale(j).orient("bottom"),m=d.svg.axis().scale(k).orient("left").ticks(10,"%"),n=d.select(".chart");n.selectAll("rect").remove(),n.selectAll("text").remove(),n.append("g").attr("transform","translate("+e.left+","+e.top+")");var o="http://salary360.initiumdata.com/api/census2011/areas/"+a.area+"/"+a.gender+"/data.csv";d.csv(o,function(e){var f=e.map(function(a){return[a.row,a.value]}),g=c(e,a.salary,b),h=d.select(".message");h.selectAll("div").remove(),h.append("div").text("You beat "+Math.floor(100*g.ratio)+"% of the "+a.gender+" in your area").attr("class","message"),j.domain(f.map(function(a){return a[0]})),k.domain([0,1.2*d.max(f,function(a){return+a[1]})]),n.append("g").attr("class","x axis").attr("transform","translate(0,"+i+")").call(l),n.append("g").attr("class","y axis").call(m).append("text").attr("transform","rotate(-90)").attr("y",6).attr("dy",".71em").style("text-anchor","end").text("Monthly Income");var o=n.selectAll(".bar").data(f);o.exit().remove(),o.enter().append("rect").attr("class","bar").attr("x",function(a){return j(a[0])}).attr("width",j.rangeBand()).attr("y",function(a){return k(a[1])}).attr("height",function(a){return i-k(a[1])}),d.selectAll(".bar").filter(function(a){return a[0]===g.binName}).attr("class","bar highlight");var p=j(f[g.binID][0]),q=k(f[g.binID][1]);console.log(p),console.log(q),n.append("text").attr("x",p).attr("y",q).attr("dy","-1em").text("You are here").attr("class","text highlight")})};a.$watch("area",function(){d(d3)}),a.$watch("gender",function(){d(d3)}),a.$watch("salary",function(){d(d3)})}}}]);