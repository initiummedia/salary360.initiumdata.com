"use strict";angular.module("salary360initiumdatacomApp",["ngAnimate","ngAria","ngCookies","ngMessages","ngResource","ngRoute","ngSanitize","ngTouch"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/about",{templateUrl:"views/about.html",controller:"AboutCtrl"}).otherwise({redirectTo:"/"})}]),angular.module("salary360initiumdatacomApp").controller("MainCtrl",["$scope","$http",function(a,b){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"],a.input={region:"hk",district:"a",area:"a01",gender:"both",salary:11555},a.options={region:["hk","kl","nt"],district:["a","b","c"],area:["a01","b02","c03"],gender:["male","female","both"]},b.get("http://salary360.initiumdata.com/api/census2011/geo/translation-areas.json").success(function(b){a.translationAreas=b}),b.get("http://salary360.initiumdata.com/api/census2011/geo/translation-districts.json").success(function(b){a.translationDistricts=b}),b.get("http://salary360.initiumdata.com/api/census2011/geo/translation-regions.json").success(function(b){a.translationRegions=b}),b.get("http://salary360.initiumdata.com/api/census2011/geo/geo-tree.json").success(function(b){a.geoTree=b}),a.getDistrictByRegion=function(){a.options.district=_.map(a.geoTree[a.input.region],function(a,b){return b}),a.input.district=a.options.district[0],a.getAreaByDistrict()},a.getAreaByDistrict=function(){a.options.area=a.geoTree[a.input.region][a.input.district],a.input.area=a.options.area[0]},b.get("http://salary360.initiumdata.com/api/census2011/geo/translation-areas.json").success(function(b){a.options.area=_.map(b,function(a,b){return b})})}]),angular.module("salary360initiumdatacomApp").controller("AboutCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("salary360initiumdatacomApp").directive("salaryRankingChart",[function(){return{restrict:"EA",scope:{area:"@",gender:"@",salary:"@"},link:function(a){var b=[[-1,"< 2000","a78_<","78"],[2e3,"2000 - 3999","a80_2000","80"],[4e3,"4000 - 5999","a82_4000","82"],[6e3,"6000 - 7999","a84_6000","84"],[8e3,"8000 - 9999","a86_8000","86"],[1e4,"10000 - 14999","a88_10000","88"],[15e3,"15000 - 19999","a90_15000","90"],[2e4,"20000 - 24999","a92_20000","92"],[25e3,"25000 - 29999","a94_25000","94"],[3e4,"30000 - 39999","a96_30000","96"],[4e4,"40000 - 59999","a98_40000","98"],[6e4,">= 60000","a100_>=","100"]],c=function(a,b,c){for(var d=0,e=0,f=0,g=a[0].row,h=1;h<c.length;h++){var i=parseInt(a[h-1].value);e+=i,c[h][0]<=b&&(d+=i,f=h,g=a[h].row)}return{binID:f,binName:g,cummulative:d,total:e,ratio:d/e}},d=function(d){var e={top:20,right:20,bottom:30,left:40},f=document.querySelector(".chart").offsetWidth,g=document.querySelector(".chart").offsetHeight,h=f-e.left-e.right,i=g-e.top-e.bottom,j=d.scale.ordinal().rangeRoundBands([0,h],.1),k=d.scale.linear().range([i,0]),l=(d.svg.axis().scale(j).orient("bottom"),d.svg.axis().scale(k).orient("left").ticks(10,"%")),m=d.select(".chart");m.selectAll("rect").remove(),m.selectAll("text").remove(),m.append("g").attr("transform","translate("+e.left+","+e.top+")");var n="http://salary360.initiumdata.com/api/census2011/areas/"+a.area+"/"+a.gender+"/data.csv";d.csv(n,function(e){var f=e.map(function(a){return[a.row,a.value]}),g=c(e,a.salary,b),h=d.select(".message");h.selectAll("div").remove(),h.append("div").text("You beat "+Math.floor(100*g.ratio)+"% of the "+a.gender+" in your area").attr("class","message"),j.domain(f.map(function(a){return a[0]})),k.domain([0,1.2*d.max(f,function(a){return+a[1]})]),m.append("g").attr("class","y axis").call(l).append("text").attr("transform","rotate(-90)").attr("y",6).attr("dy",".71em").style("text-anchor","end").text("Monthly Income");var n=m.selectAll(".bar").data(f);n.exit().remove(),n.enter().append("rect").attr("class","bar").attr("x",function(a){return j(a[0])}).attr("width",j.rangeBand()).attr("y",function(a){return k(a[1])}).attr("height",function(a){return i-k(a[1])}),d.selectAll(".bar").filter(function(a){return a[0]===g.binName}).attr("class","bar highlight");var o=j(f[g.binID][0]),p=k(f[g.binID][1]);console.log(o),console.log(p),m.append("text").attr("x",o).attr("y",p).attr("dy","-1em").text("You are here").attr("class","text highlight")})};a.$watch("area",function(){d(d3)}),a.$watch("gender",function(){d(d3)}),a.$watch("salary",function(){d(d3)})}}}]);